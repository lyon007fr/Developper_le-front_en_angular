{"ast":null,"code":"import { BehaviorSubject, throwError } from 'rxjs';\nimport { catchError, tap, map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class OlympicService {\n  constructor(http) {\n    this.http = http;\n    this.olympicUrl = './assets/mock/olympic.json';\n    this.olympics$ = new BehaviorSubject([]);\n    this.MedalCountByCountry = new BehaviorSubject([]);\n    this.numberOfJO = new BehaviorSubject(0);\n  }\n  //gestion erreur\n  handleError(error) {\n    if (error.status === 0) {\n      // erreur client\n      console.error('An error occurred:', error.error);\n    } else {\n      // erreur backend\n      console.error(`Erreur serveur ${error.status}, message d'erreur: `, error.error);\n    }\n    // Retourne un observable\n    return throwError(() => new Error('Merci de ressayer plus tard'));\n  }\n  loadInitialData() {\n    return this.http.get(this.olympicUrl).pipe(tap(value => {\n      this.olympics$.next(value);\n      this.MedalCountByCountry.next(this.getObjectMedal(value));\n    }), catchError(this.handleError));\n  }\n  getOlympics() {\n    return this.olympics$.asObservable();\n  }\n  getMedalCount() {\n    return this.MedalCountByCountry.asObservable();\n  }\n  /*\n  *Calcule le nombre total de médailles pour chaque pays dans les Jeux Olympiques.\n  *@param :{Olympic[]} olympic - La liste des données olympiques.\n  *@return : {MedalCount[]}: un tableau d'objet representant le compte des médailles de chaque pays\n  */\n  getObjectMedal(olympic) {\n    let medalCounts = [];\n    for (let country in olympic) {\n      let totalMedalByCountry = 0;\n      let totalByCountry = {\n        name: '',\n        value: 0\n      };\n      totalMedalByCountry = olympic[country].participations.reduce((acc, item) => acc + item.medalsCount, 0);\n      totalByCountry.name = olympic[country].country;\n      totalByCountry.value = totalMedalByCountry;\n      medalCounts.push(totalByCountry);\n    }\n    return medalCounts;\n  }\n  getDataByCountry(country) {\n    return this.http.get(this.olympicUrl).pipe(\n    //ajouter une gestion d'erreur\n    map(data => data.filter(item => item.country === country)), catchError(this.handleError));\n  }\n  static #_ = this.ɵfac = function OlympicService_Factory(t) {\n    return new (t || OlympicService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: OlympicService,\n    factory: OlympicService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","throwError","catchError","tap","map","OlympicService","constructor","http","olympicUrl","olympics$","MedalCountByCountry","numberOfJO","handleError","error","status","console","Error","loadInitialData","get","pipe","value","next","getObjectMedal","getOlympics","asObservable","getMedalCount","olympic","medalCounts","country","totalMedalByCountry","totalByCountry","name","participations","reduce","acc","item","medalsCount","push","getDataByCountry","data","filter","_","i0","ɵɵinject","i1","HttpClient","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\MBD7C62N\\Repo Git\\python\\Developpez-le-front-end-en-utilisant-Angular\\src\\app\\core\\services\\olympic.service.ts"],"sourcesContent":["import { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\r\nimport { catchError, tap, map } from 'rxjs/operators';\r\nimport { Olympic } from '../models/olympic';\r\nimport { MedalCount } from '../models/medal-count';\r\nimport { Participation } from '../models/participation';\r\n\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class OlympicService {\r\n  private olympicUrl = './assets/mock/olympic.json';\r\n  private olympics$ = new BehaviorSubject<Olympic[]>([]);\r\n  private MedalCountByCountry = new BehaviorSubject<MedalCount[]>([]);\r\n  private numberOfJO = new BehaviorSubject<number>(0)\r\n  \r\n\r\n  \r\n  constructor(private http: HttpClient) {}\r\n\r\n  //gestion erreur\r\n  private handleError(error: HttpErrorResponse):Observable<never> {\r\n    if (error.status === 0) {\r\n      // erreur client\r\n      console.error('An error occurred:', error.error);\r\n    } else {\r\n      // erreur backend\r\n      console.error(\r\n        `Erreur serveur ${error.status}, message d'erreur: `, error.error);\r\n    }\r\n    // Retourne un observable\r\n    return throwError(() => new Error('Merci de ressayer plus tard'));\r\n  }\r\n\r\n\r\n  \r\n  loadInitialData(): Observable<Olympic[]> {\r\n    return this.http.get<Olympic[]>(this.olympicUrl).pipe(\r\n      tap((value) => {\r\n        this.olympics$.next(value);\r\n        this.MedalCountByCountry.next(this.getObjectMedal(value));\r\n      }),\r\n      \r\n      catchError(this.handleError) \r\n    );\r\n  }\r\n\r\n\r\n\r\n\r\n  getOlympics():Observable<Olympic[]> {\r\n    return this.olympics$.asObservable();\r\n  }\r\n\r\n\r\n\r\n  getMedalCount():Observable<MedalCount[]>{\r\n    return this.MedalCountByCountry.asObservable()\r\n  }\r\n\r\n  /*\r\n  *Calcule le nombre total de médailles pour chaque pays dans les Jeux Olympiques.\r\n  *@param :{Olympic[]} olympic - La liste des données olympiques.\r\n  *@return : {MedalCount[]}: un tableau d'objet representant le compte des médailles de chaque pays\r\n  */\r\n  getObjectMedal(olympic: Olympic[]):MedalCount[] {\r\n      let medalCounts : MedalCount[] = [];\r\n      for (let country in olympic) {\r\n        let totalMedalByCountry = 0;\r\n        let totalByCountry: MedalCount = {name: '',\r\n                          value: 0};\r\n        totalMedalByCountry = olympic[country].participations.reduce((acc, item) => acc + item.medalsCount, 0);\r\n        totalByCountry.name = olympic[country].country;\r\n        totalByCountry.value = totalMedalByCountry;\r\n        medalCounts.push(totalByCountry);\r\n      }\r\n      return medalCounts;\r\n\r\n}\r\n  getDataByCountry(country: string): Observable<Olympic[]> {\r\n    return this.http.get<Olympic[]>(this.olympicUrl).pipe(//ajouter une gestion d'erreur\r\n      map(data => data.filter(item => item.country === country)),\r\n      \r\n      catchError(this.handleError) \r\n    );\r\n  }\r\n\r\n\r\n\r\n  \r\n  \r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}